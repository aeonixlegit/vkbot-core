# Использование Базы Данных бота

Использовать базу данных очень просто. Нужно лишь просто понять логику работы с JSON, объектами и массивами.

## Что необходимо

Итак, для использования базы данных в команде, нужно добавить переменную в функцию шаблона:

```js
func: async(msg, { db }) => { /* ... */ },
```

Тут мы добавили специальную переменную db, с помощью которой мы и будет связываться с базой данных :)

# Использование

Использование базы очень просто. Сейчас я вам это покажу.

Давайте сделаем команду выдачи прав:

```js
module.exports = {
  tag: ["права"],
  func: async(msg, { db }) => {
    if (!msg.fwds[0]) return msg.error('Перешлите сообщение того, кому хотите выдать права');

    const vkid = msg.fwds[0].from_id
    const right = msg.text.split(' ')[1];
    if (!rights) return msg.error('Укажите какое право выдать');

    let user = await db.getUser(vkid);
    user.right = right;
    db.write();

    msg.ok(`Пользователю [id${user.id}|${user.nick}] успешно выдано ${right} право`);
  },
  rights: 3,
  help: 'права [номер]',
  desc: 'выдать права пользователю';
 ```

Итак, давайте по порядку.

<hr />

```js
func: async(msg, { db }) => { ... }
```

Создали асинхронную функцию для работы с await и добавили переменную db для работы с базой данных.

<hr />

```js
if (!msg.fwds[0]) return msg.error('Перешлите сообщение того, кому хотите выдать права');
```

Проверили наличие пересланных сообщений. Если их нет, то возвращаем сообщение с "ошибкой".

<hr />

```js
const vkid = msg.fwds[0].from_id
const right = msg.text.split(' ')[1];
if (!rights) return msg.error('Укажите какое право выдать');
```

Создали переменную vkid, содержащую айди человка, чьё сообщение переслали.

Создали переменную right, содержащую право, которое мы указали (от 0 до 3, где 0 - пользователь, 1 - вип, 2 - админ, 3 - создатель).

Проверили наличие указанного нами права, если не найдено, то возвращаем сообщение с "ошибкой".

<hr />

```js
let user = await db.getUser(vkid);
user.right = right;
db.write();
```

Самое интересное, работа с базой данных.

Создали переменную user, содержащую информацию об указанном пользователе, с помощью созданной мной функции getUser(). К ней мы ещё вернёмся.

Присовили право указанного пользователя на указанное нами право.

Сохранили базу данных.

<hr />

```js
msg.ok(`Пользователю [id${user.id}|${user.nick}] успешно выдано ${right} право`);
```

Отправили сообщение об успешно выполненой функции.

# Полезная информация

Для более широкого использования базы данных вам следует знать как использовать вообще саму базу.

Из примера выше вы узнали, что переменная db нужна для запросам к базе данных.

Так давайте научимся делать подобные запросы:

<hr />

```js
db.get('users')
```

Получить всех пользователей без возможности посмотреть. Основа.

<hr />

```js
db.get('users').find({ id: айди }).value();
```

Получить одного пользователя прямо из базы данных. Где "айди", указывать вк айди того, кого хотите получить.

<hr />

```js
db.get('users').find().value();
```

Получить всех пользователей с возможностью просмотреть каждого.

<hr />

Чтобы "запихнуть" всех пользователей в одну переменную нужно просто её объявить. Вот так:

```js
let users = db.get('users').find().value();
```

И теперь вы может использовать эту переменную. Например отправить ник первого пользователя:

```js
msg.send(users[0].nick); // Ник первого пользователя в базе
```

<hr />

```js
db.getUser(id);
```

Получение конкретного пользователя. Моя личная функция. Если при получении пользователь не найден, то он создастся в базе.
Эдака "авторегистрация". Использовать функцию нужно с ```await```:

```js
let user = await db.getUser(1);
msg.send(user.nick)
```
